import{d as f}from"./chunk-35LWYR67.js";import{Ha as u,O as c,Ob as p,Rb as g,T as o,m as s,n as a,q as h,vb as m,y as l}from"./chunk-USG2AWOP.js";var j=(()=>{class i{constructor(t,e){this.http=t,this.router=e,this.baseUrl=g.apiBaseUrl,this.TOKEN_KEY="portfolio_jwt_token",this.tokenInMemory=null,this._isAuthenticated=u(!1),this.isAuthenticated=m(()=>this._isAuthenticated()),this.loadFromStorage()}login(t){return this.http.post(`${this.baseUrl}/Auth/login`,t,{observe:"response"}).pipe(h(e=>this.handleLoginBody(e.body,e.headers)),l(e=>{if(e.status===401&&e.error?.token){let n=this.handleLoginBody(e.error,null);return s(n)}return a(()=>e)}))}handleLoginBody(t,e){let k=(e?.get?.("Authorization")||e?.get?.("authorization"))?.replace(/^Bearer\s+/i,""),r=this.extractToken(t)||k;return r?(this.setToken(r),{token:r,username:t?.username,email:t?.email,expiration:t?.expiration||t?.expires||""}):null}extractToken(t){return t?typeof t=="string"?t:t.token||t.accessToken||t.access_token||t.jwt||t.result||t.data?.token||t.data?.accessToken||t.data?.access_token||t.data?.jwt||null:null}logout(){this.tokenInMemory=null,localStorage.removeItem(this.TOKEN_KEY),this._isAuthenticated.set(!1),this.router.navigate(["/admin/login"])}getToken(){return this.tokenInMemory||localStorage.getItem(this.TOKEN_KEY)}setToken(t){this.tokenInMemory=t,localStorage.setItem(this.TOKEN_KEY,t),this._isAuthenticated.set(!0)}loadFromStorage(){let t=localStorage.getItem(this.TOKEN_KEY);t&&(this.tokenInMemory=t,this._isAuthenticated.set(!0))}static{this.\u0275fac=function(e){return new(e||i)(o(p),o(f))}}static{this.\u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{j as a};
